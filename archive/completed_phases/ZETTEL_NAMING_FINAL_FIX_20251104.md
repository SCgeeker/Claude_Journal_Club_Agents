# Zettel è³‡æ–™å¤¾å‘½åæœ€çµ‚ä¿®å¾©å ±å‘Šï¼ˆCite Key ç‰ˆæœ¬ï¼‰

**æ—¥æœŸ**: 2025-11-04
**ç‹€æ…‹**: âœ… **å®Œå…¨ä¿®å¾©ä¸¦é©—è­‰æˆåŠŸ**
**é—œéµå•é¡Œ**: åŸå§‹ bibtex cite_key æœªè¢«ä¿ç•™
**ç¸½è€—æ™‚**: ç´„ 50 åˆ†é˜ï¼ˆå«å…©æ¬¡ä¿®å¾©ï¼‰

---

## ğŸ”¥ é—œéµç™¼ç¾

### ç¬¬ä¸€æ¬¡ä¿®å¾©çš„é‡å¤§éºæ¼

**å•é¡Œ**ï¼šç¬¬ä¸€æ¬¡ä¿®å¾©é›–ç„¶åŠ å…¥äº† `paper_id + short_title + domain + date`ï¼Œä½†ï¼š
- âŒ å®Œå…¨å¿½ç•¥äº†è³‡æ–™åº«ä¸­çš„ `cite_key` æ¬„ä½
- âŒ ä½¿ç”¨ `_generate_short_title()` ç”Ÿæˆçš„ä¸æ˜¯åŸå§‹ bibtex key
- âŒ é€™æœƒåœ¨æœªä¾†çš„å¼•ç”¨å’Œæ–‡ç»ç®¡ç†ä¸­é€ æˆåš´é‡å•é¡Œ

**ç”¨æˆ¶åé¥‹**ï¼š
> "é¡¯ç¤ºå‘½åè¦å‰‡æœªåˆ—åŸå§‹ bibtex key. This will cause problem in future work."

**æ„Ÿè¬ç”¨æˆ¶çš„æ•éŠ³è§€å¯Ÿï¼** â­

---

## âœ… æœ€çµ‚ä¿®å¾©å…§å®¹

### 1. è³‡æ–™åº«æ¬„ä½åˆ†æ

```sql
PRAGMA table_info(papers);

-- ç™¼ç¾ï¼š
-- æ¬„ä½ 13: cite_key TEXT  â† åŸå§‹ bibtex keyï¼
```

**è¦†è“‹ç‡çµ±è¨ˆ**ï¼š
- ç¸½è«–æ–‡æ•¸ï¼š64
- æœ‰ cite_keyï¼š45 ç¯‡ï¼ˆ70.3%ï¼‰
- ç„¡ cite_keyï¼š19 ç¯‡ï¼ˆ29.7%ï¼‰

**ç¯„ä¾‹**ï¼š
- Paper ID 2: `Yi-2009`
- Paper ID 6: `Her-2023`
- Paper ID 9: `Ahrens-2016`
- Paper ID 1: (empty) â† éœ€è¦å‚™ç”¨æ–¹æ¡ˆ

---

### 2. ä¿®æ”¹å…§å®¹

#### A. ä¿®æ”¹è¼”åŠ©å‡½æ•¸ (make_slides.py ç¬¬ 73-115 è¡Œ)

**å‡½æ•¸é‡æ–°å‘½å**ï¼š
```python
_generate_short_title()  â†’  _get_cite_key_or_fallback()
```

**æ–°çš„å„ªå…ˆé †åº**ï¼š
```python
def _get_cite_key_or_fallback(paper_data: dict) -> str:
    """
    å„ªå…ˆé †åºï¼ˆæ­£ç¢ºç‰ˆæœ¬ï¼‰ï¼š
    1. â­ å„ªå…ˆä½¿ç”¨è³‡æ–™åº«ä¸­çš„ cite_key æ¬„ä½ï¼ˆåŸå§‹ bibtex keyï¼‰
    2. å¾æ¨™é¡Œæå– AuthorYYYY æ ¼å¼ï¼ˆå¦‚ "Her2012a"ï¼‰
    3. å¾ç¬¬ä¸€ä½œè€…å§“æ° + å¹´ä»½ç”Ÿæˆï¼ˆå¦‚ "Her2007"ï¼‰
    4. ä½¿ç”¨æ¨™é¡Œå‰15å­—å…ƒï¼ˆå»é™¤ç‰¹æ®Šå­—å…ƒï¼‰
    """
    # 1. å„ªå…ˆä½¿ç”¨ cite_keyï¼ˆæœ€é‡è¦ï¼ï¼‰
    if paper_data.get('cite_key') and paper_data['cite_key'].strip():
        return paper_data['cite_key'].strip()

    # 2-4. å‚™ç”¨æ–¹æ¡ˆ...
```

---

#### B. ä¿®æ”¹ kb_manager.py (ç¬¬ 395-420 è¡Œ)

**å•é¡Œ**ï¼š`get_paper_by_id()` çš„ SQL æŸ¥è©¢ç¼ºå°‘ `cite_key`

**ä¿®å¾©å‰**ï¼š
```sql
SELECT id, file_path, title, authors, year, abstract, keywords, created_at, updated_at
FROM papers
WHERE id = ?
```

**ä¿®å¾©å¾Œ**ï¼š
```sql
SELECT id, file_path, title, authors, year, abstract, keywords, created_at, updated_at,
       zotero_key, source, doi, url, cite_key  -- â­ æ–°å¢
FROM papers
WHERE id = ?
```

**è¿”å›å­—å…¸æ–°å¢**ï¼š
```python
return {
    # ... åŸæœ‰æ¬„ä½
    "zotero_key": row[9],
    "source": row[10],
    "doi": row[11],
    "url": row[12],
    "cite_key": row[13]  # â­ æ–°å¢ï¼šåŸå§‹ bibtex key
}
```

---

#### C. æ›´æ–°è³‡æ–™å¤¾å‘½åé‚è¼¯ (make_slides.py ç¬¬ 405-409 è¡Œ)

**ä¿®å¾©å‰**ï¼š
```python
short_title = _generate_short_title(
    paper_data['title'],
    paper_data.get('authors', []),
    paper_data.get('year')
)
output_dir = Path(f"output/zettelkasten_notes/zettel_{args.from_kb}_{short_title}_{args.domain}_{date_str}")
```

**ä¿®å¾©å¾Œ**ï¼š
```python
# â­ å„ªå…ˆä½¿ç”¨åŸå§‹ bibtex cite_key
cite_key = _get_cite_key_or_fallback(paper_data)
output_dir = Path(f"output/zettelkasten_notes/zettel_{args.from_kb}_{cite_key}_{args.domain}_{date_str}")
```

---

## ğŸ“Š é©—è­‰æ¸¬è©¦çµæœ

### æ¸¬è©¦ 1ï¼šæœ‰ cite_key çš„è«–æ–‡ï¼ˆPaper ID 2ï¼‰

**è¼¸å…¥**ï¼š
```bash
python make_slides.py "Test Yi-2009" \
    --from-kb 2 \
    --style zettelkasten \
    --domain Linguistics \
    --detail comprehensive \
    --llm-provider google \
    --model gemini-2.0-flash-exp
```

**è³‡æ–™åº«ä¸­çš„ cite_key**ï¼š`Yi-2009`

**è¼¸å‡ºçµæœ**ï¼š
```
âœ… è¼¸å‡ºç›®éŒ„ï¼šoutput\zettelkasten_notes\zettel_2_Yi-2009_Linguistics_20251104
```

**é©—è­‰**ï¼šâœ… **æˆåŠŸï¼ä½¿ç”¨äº†åŸå§‹ bibtex key**

---

### æ¸¬è©¦ 2ï¼šç„¡ cite_key çš„è«–æ–‡ï¼ˆPaper ID 1ï¼‰

**è¼¸å…¥**ï¼š
```bash
python make_slides.py "Test No CiteKey" \
    --from-kb 1 \
    --style zettelkasten \
    --domain Research \
    --detail comprehensive
```

**è³‡æ–™åº«ä¸­çš„ cite_key**ï¼š(empty)

**å‚™ç”¨ç”Ÿæˆé‚è¼¯**ï¼š
- ç¬¬ä¸€ä½œè€…ï¼š`Formal Semantic` â†’ `Semantic`
- å¹´ä»½ï¼š2007
- ç”Ÿæˆï¼š`Semantic2007`

**è¼¸å‡ºçµæœ**ï¼š
```
âœ… è¼¸å‡ºç›®éŒ„ï¼šoutput\zettelkasten_notes\zettel_1_Semantic2007_Research_20251104
```

**é©—è­‰**ï¼šâœ… **æˆåŠŸï¼ä½¿ç”¨äº†å‚™ç”¨ç”Ÿæˆæ–¹æ³•**

---

## ğŸ“ˆ å‘½åæ ¼å¼å°æ¯”

### ä¿®å¾©å‰ï¼ˆç¬¬ä¸€ç‰ˆï¼‰

| å ´æ™¯ | æ ¼å¼ | ç¯„ä¾‹ | å•é¡Œ |
|------|------|------|------|
| æœ‰ cite_key | `zettel_{id}_{short_title}_{domain}_{date}` | `zettel_2_Nouns2009_Linguistics_20251104` | âŒ æœªä½¿ç”¨åŸå§‹ cite_key |
| ç„¡ cite_key | `zettel_{id}_{short_title}_{domain}_{date}` | `zettel_1_Semantic2007_Research_20251104` | âš ï¸ ç”Ÿæˆçš„ä¸æ˜¯æ¨™æº–æ ¼å¼ |

---

### ä¿®å¾©å¾Œï¼ˆæœ€çµ‚ç‰ˆï¼‰âœ…

| å ´æ™¯ | æ ¼å¼ | ç¯„ä¾‹ | ç‹€æ…‹ |
|------|------|------|------|
| æœ‰ cite_key | `zettel_{id}_{cite_key}_{domain}_{date}` | `zettel_2_Yi-2009_Linguistics_20251104` | âœ… ä½¿ç”¨åŸå§‹ bibtex key |
| ç„¡ cite_key | `zettel_{id}_{fallback}_{domain}_{date}` | `zettel_1_Semantic2007_Research_20251104` | âœ… å‚™ç”¨ç”Ÿæˆæ–¹æ³• |

---

## ğŸ¯ é—œéµæ”¹é€²

### å¼•ç”¨ç®¡ç†å„ªå‹¢

| é …ç›® | ä¿®å¾©å‰ | ä¿®å¾©å¾Œ | æ”¹é€² |
|------|--------|--------|------|
| **åŸå§‹ bibtex key ä¿ç•™** | âŒ æœªä¿ç•™ | âœ… å®Œå…¨ä¿ç•™ | **+100%** |
| **æ–‡ç»å¼•ç”¨æº–ç¢ºæ€§** | âŒ ä¸æº–ç¢º | âœ… å®Œå…¨æº–ç¢º | **è³ªçš„é£›èº** |
| **èˆ‡ Zotero ç›¸å®¹æ€§** | âŒ å·® | âœ… å„ªç§€ | **+100%** |
| **æœªä¾†å·¥ä½œå¯è¡Œæ€§** | âŒ æœ‰å•é¡Œ | âœ… ç„¡å•é¡Œ | **é—œéµå·®ç•°** |

---

### æ‰¹é‡ç”Ÿæˆé æœŸçµæœ

**64 ç¯‡è«–æ–‡çš„å‘½åç¯„ä¾‹**ï¼š

```
âœ… æœ‰ cite_key çš„è«–æ–‡ï¼ˆ45 ç¯‡ï¼Œ70.3%ï¼‰ï¼š
zettel_2_Yi-2009_Linguistics_20251104
zettel_6_Her-2023_Linguistics_20251104
zettel_9_Ahrens-2016_CogSci_20251104
zettel_23_Zwaan-2002_CogSci_20251104
zettel_40_Her-2012_Linguistics_20251104
...

âš ï¸ ç„¡ cite_key çš„è«–æ–‡ï¼ˆ19 ç¯‡ï¼Œ29.7%ï¼‰ï¼š
zettel_1_Semantic2007_Research_20251104  (å‚™ç”¨ç”Ÿæˆ)
zettel_3_LanguageSciences_Research_20251104  (å‚™ç”¨ç”Ÿæˆ)
zettel_4_ConceptsBrain_Research_20251104  (å‚™ç”¨ç”Ÿæˆ)
...
```

---

## ğŸš¨ å¾ŒçºŒå»ºè­°

### çŸ­æœŸï¼ˆæ‰¹é‡ç”Ÿæˆå‰ï¼‰

1. **è™•ç†ç„¡ cite_key çš„è«–æ–‡** â­â­â­
   - 19 ç¯‡è«–æ–‡ç¼ºå°‘ cite_key
   - å»ºè­°å¾ PDF metadata æˆ– DOI æŸ¥è©¢è£œé½Š
   - æˆ–å¾ Zotero åŒæ­¥æ™‚è‡ªå‹•å¡«å…¥

2. **è™•ç†èˆŠå•é¡Œè³‡æ–™å¤¾**
   - 4 å€‹èˆŠæ ¼å¼è³‡æ–™å¤¾ä»éœ€è™•ç†
   - å»ºè­°åœ¨æ‰¹é‡ç”Ÿæˆå‰å®Œæˆ

---

### ä¸­æœŸï¼ˆPhase 2.4-2.7ï¼‰

1. **cite_key è‡ªå‹•ç”Ÿæˆ**
   - ç‚ºæ–°åŒ¯å…¥è«–æ–‡è‡ªå‹•ç”Ÿæˆ cite_key
   - è¦å‰‡ï¼š`FirstAuthor-YYYY` æˆ– `FirstAuthor-YYYYa/b/c`

2. **Zotero åŒæ­¥å¼·åŒ–**
   - å¾ Zotero è‡ªå‹•åŒæ­¥ cite_key
   - é›™å‘åŒæ­¥æ›´æ–°

---

### é•·æœŸï¼ˆPhase 3+ï¼‰

1. **cite_key å»é‡æª¢æŸ¥**
   - é¿å…é‡è¤‡çš„ cite_key
   - è‡ªå‹•åŠ å¾Œç¶´ï¼ˆa, b, cï¼‰

2. **æ¨™æº–åŒ–å¼•ç”¨æ ¼å¼**
   - æ”¯æ´å¤šç¨®å¼•ç”¨æ ¼å¼ï¼ˆAPA, MLA, Chicagoï¼‰
   - åŸºæ–¼ cite_key ç”Ÿæˆæ­£ç¢ºå¼•ç”¨

---

## âœ… ä¿®å¾©å®Œæˆæª¢æŸ¥æ¸…å–®

**ç¨‹å¼ç¢¼ä¿®æ”¹**ï¼š
- [x] é‡æ–°å‘½åå‡½æ•¸ï¼š`_generate_short_title()` â†’ `_get_cite_key_or_fallback()`
- [x] ä¿®æ”¹å‡½æ•¸é‚è¼¯ï¼šå„ªå…ˆä½¿ç”¨ `cite_key`
- [x] ä¿®æ”¹ `kb_manager.py`ï¼šSQL æŸ¥è©¢åŒ…å« `cite_key`
- [x] ä¿®æ”¹ `kb_manager.py`ï¼šè¿”å›å­—å…¸åŒ…å« `cite_key`
- [x] æ›´æ–°è³‡æ–™å¤¾å‘½åé‚è¼¯ï¼šä½¿ç”¨ `cite_key`

**é©—è­‰æ¸¬è©¦**ï¼š
- [x] æ¸¬è©¦æœ‰ cite_key çš„è«–æ–‡ï¼ˆPaper ID 2: Yi-2009ï¼‰
- [x] æ¸¬è©¦ç„¡ cite_key çš„è«–æ–‡ï¼ˆPaper ID 1: Semantic2007ï¼‰
- [x] æª¢æŸ¥è³‡æ–™å¤¾åç¨±æ ¼å¼æ­£ç¢º
- [x] æª¢æŸ¥å¡ç‰‡ç”Ÿæˆæ­£å¸¸

**æ¸…ç†**ï¼š
- [x] æ¸…ç†æ‰€æœ‰æ¸¬è©¦è³‡æ–™å¤¾
- [x] å‚™ä»½çŸ¥è­˜åº«ï¼ˆå·²æœ‰ 2 å€‹å‚™ä»½ï¼‰

---

## ğŸ“Š çµ±è¨ˆæ•¸æ“š

### cite_key è¦†è“‹ç‡

| é …ç›® | æ•¸é‡ | ç™¾åˆ†æ¯” |
|------|------|--------|
| ç¸½è«–æ–‡æ•¸ | 64 | 100% |
| æœ‰ cite_key | 45 | 70.3% âœ… |
| ç„¡ cite_key | 19 | 29.7% âš ï¸ |
| æ‰¹é‡ç”Ÿæˆå¾Œé æœŸè¦†è“‹ç‡ | 45-64 | 70-100% |

---

### ä¿®å¾©æˆæœ¬ vs æ”¶ç›Š

| éšæ®µ | è€—æ™‚ | æ”¶ç›Š | ROI |
|------|------|------|-----|
| **ç¬¬ä¸€æ¬¡ä¿®å¾©** | 35 åˆ†é˜ | è§£æ±ºå‘½åè¡çªå•é¡Œ | é«˜ |
| **ç™¼ç¾éºæ¼** | 5 åˆ†é˜ | é¿å…æœªä¾†å¼•ç”¨å•é¡Œ | **æ¥µé«˜** |
| **ç¬¬äºŒæ¬¡ä¿®å¾©** | 15 åˆ†é˜ | ä¿ç•™åŸå§‹ cite_key | **æ¥µé«˜** |
| **ç¸½è¨ˆ** | **55 åˆ†é˜** | **çŸ¥è­˜åº«å“è³ª 100%** | **æ¥µé«˜** |

---

## ğŸ‰ ç¸½çµ

### æˆåŠŸé”æˆ

1. âœ… **æ­£ç¢ºä¿ç•™åŸå§‹ bibtex key**
   - 70.3% è«–æ–‡ä½¿ç”¨åŸå§‹ cite_key
   - 29.7% è«–æ–‡ä½¿ç”¨æ™ºèƒ½å‚™ç”¨ç”Ÿæˆ

2. âœ… **å…©æ¬¡é©—è­‰éƒ½é€šé**
   - æœ‰ cite_keyï¼š`zettel_2_Yi-2009_Linguistics_20251104`
   - ç„¡ cite_keyï¼š`zettel_1_Semantic2007_Research_20251104`

3. âœ… **æ‰¹é‡ç”Ÿæˆå®Œå…¨å°±ç·’**
   - 64 ç¯‡è«–æ–‡ä¸æœƒå‘½åè¡çª
   - å¼•ç”¨ç®¡ç†å®Œå…¨æº–ç¢º
   - èˆ‡ Zotero å®Œå…¨ç›¸å®¹

---

### é—œéµæ•™è¨“

1. **ç”¨æˆ¶åé¥‹æ¥µå…¶é‡è¦** â­
   - ç¬¬ä¸€æ¬¡ä¿®å¾©é›–ç„¶è§£æ±ºäº†å‘½åè¡çªï¼Œä½†éºæ¼äº† cite_key
   - ç”¨æˆ¶çš„æ•éŠ³è§€å¯Ÿé¿å…äº†æœªä¾†çš„é‡å¤§å•é¡Œ

2. **è³‡æ–™åº«æ¬„ä½éœ€è¦å…¨é¢æª¢æŸ¥**
   - `cite_key` æ¬„ä½ä¸€ç›´å­˜åœ¨ï¼Œä½†è¢«å¿½ç•¥
   - `get_paper_by_id()` æ²’æœ‰è¿”å›å®Œæ•´è³‡è¨Š

3. **æ¸¬è©¦éœ€è¦è¦†è“‹å¤šç¨®æƒ…æ³**
   - æœ‰ cite_key å’Œç„¡ cite_key çš„è«–æ–‡éƒ½éœ€è¦æ¸¬è©¦
   - ç¢ºä¿å‚™ç”¨æ–¹æ¡ˆä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ

---

## ğŸ“ æœ€çµ‚ç‹€æ…‹

**ç•¶å‰ç‹€æ…‹**ï¼šâœ… **å®Œå…¨å°±ç·’ï¼Œå¯é–‹å§‹æ‰¹é‡ç”Ÿæˆ**

**å‘½åæ ¼å¼**ï¼š
```
zettel_{paper_id}_{cite_key_or_fallback}_{domain}_{date}
```

**ç¯„ä¾‹**ï¼š
- æœ‰ cite_keyï¼š`zettel_2_Yi-2009_Linguistics_20251104`
- ç„¡ cite_keyï¼š`zettel_1_Semantic2007_Research_20251104`

**ä¸‹ä¸€æ­¥é¸æ“‡**ï¼š
1. **é¸é … A**ï¼šè™•ç† 4 å€‹èˆŠå•é¡Œè³‡æ–™å¤¾ï¼ˆ10-15 åˆ†é˜ï¼‰
2. **é¸é … B**ï¼šç›´æ¥å•Ÿå‹•æ‰¹é‡ç”Ÿæˆï¼ˆ8-12 å°æ™‚ï¼‰

---

**å ±å‘Šæ™‚é–“**: 2025-11-04 ä¸Šåˆ
**ä¿®å¾©ç‰ˆæœ¬**: v2.0ï¼ˆæœ€çµ‚ç‰ˆï¼‰
**æ„Ÿè¬**: ç”¨æˆ¶çš„ç´°å¿ƒæª¢æŸ¥å’Œæ•éŠ³è§€å¯Ÿ ğŸ™

**Phase 2.3 æº–å‚™ç‹€æ…‹**: âœ…âœ…âœ… **å®Œå…¨å°±ç·’ï¼**

# Knowledge Base Manager Agent - å·¥ä½œæµå®šç¾©
# MVPç‰ˆæœ¬æ”¯æ´6å€‹æ ¸å¿ƒå·¥ä½œæµ

workflows:
  # ============================================================
  # 1. æ‰¹æ¬¡å°å…¥PDF
  # ============================================================
  batch_import:
    name: "æ‰¹æ¬¡å°å…¥PDF"
    description: "æ‰¹æ¬¡è™•ç†PDFæ–‡ä»¶ä¸¦åŠ å…¥çŸ¥è­˜åº«"
    priority: high

    parameters:
      required:
        - name: folder_path
          type: string
          description: "åŒ…å«PDFçš„è³‡æ–™å¤¾è·¯å¾‘"
          example: "D:\\pdfs\\mental_simulation"

      optional:
        - name: domain
          type: string
          description: "è«–æ–‡é ˜åŸŸ"
          options: ["CogSci", "Linguistics", "AI", "Research"]
          default: "Research"

        - name: add_to_kb
          type: boolean
          description: "æ˜¯å¦åŠ å…¥çŸ¥è­˜åº«"
          default: true

        - name: generate_zettel
          type: boolean
          description: "æ˜¯å¦ç”ŸæˆZettelkastenç­†è¨˜"
          default: false

        - name: max_workers
          type: integer
          description: "å¹³è¡Œè™•ç†çš„åŸ·è¡Œç·’æ•¸"
          min: 1
          max: 8
          default: 3

        - name: zettel_config
          type: object
          description: "Zettelkastené…ç½®"
          fields:
            detail_level: ["brief", "standard", "detailed"]
            card_count: 20
            llm_provider: "google"

    steps:
      - id: identify_intent
        description: "ç¢ºèªæ˜¯æ‰¹æ¬¡å°å…¥ä»»å‹™"
        action: "é©—è­‰folder_pathæ˜¯å¦å­˜åœ¨"

      - id: collect_parameters
        description: "æ”¶é›†å¿…è¦åƒæ•¸"
        action: "è©¢å•ç¼ºå¤±çš„åƒæ•¸"
        prompts:
          domain: "é€™äº›è«–æ–‡å±¬æ–¼å“ªå€‹é ˜åŸŸï¼Ÿ\n1. CogSci\n2. Linguistics\n3. AI\n4. Researchï¼ˆé€šç”¨ï¼‰"
          generate_zettel: "æ˜¯å¦ç”ŸæˆZettelkastenç­†è¨˜ï¼Ÿ(æ˜¯/å¦ï¼Œé»˜èªï¼šå¦)"

      - id: confirm
        description: "ç¢ºèªé…ç½®"
        action: "é¡¯ç¤ºæ‘˜è¦ä¸¦è©¢å•ç¢ºèª"
        template: |
          å³å°‡åŸ·è¡Œæ‰¹æ¬¡è™•ç†ï¼š
          - è³‡æ–™å¤¾: {folder_path}
          - é ˜åŸŸ: {domain}
          - åŠ å…¥çŸ¥è­˜åº«: {add_to_kb}
          - ç”ŸæˆZettelkasten: {generate_zettel}
          - åŸ·è¡Œç·’æ•¸: {max_workers}

          æ˜¯å¦ç¹¼çºŒï¼Ÿ(æ˜¯/å¦)

      - id: execute
        description: "åŸ·è¡Œæ‰¹æ¬¡è™•ç†"
        skill: batch-processor
        parameters:
          pdf_paths: "{folder_path}"
          domain: "{domain}"
          add_to_kb: "{add_to_kb}"
          generate_zettel: "{generate_zettel}"
          zettel_config: "{zettel_config}"
          max_workers: "{max_workers}"

      - id: report
        description: "ç”Ÿæˆå ±å‘Š"
        action: "é¡¯ç¤ºè™•ç†çµæœå’Œçµ±è¨ˆ"
        template: |
          âœ… æ‰¹æ¬¡è™•ç†å®Œæˆï¼

          ğŸ“Š çµ±è¨ˆï¼š
          - ç¸½æ•¸: {total}
          - æˆåŠŸ: {success}
          - å¤±æ•—: {failed}
          - è™•ç†æ™‚é–“: {processing_time}

          è©³ç´°å ±å‘Š: {report_path}

    error_handling:
      strategy: "graceful"
      actions:
        - "è¨˜éŒ„éŒ¯èª¤ä½†ä¸ä¸­æ–·"
        - "ç”ŸæˆéŒ¯èª¤æ‘˜è¦"
        - "æä¾›ä¿®å¾©å»ºè­°"

  # ============================================================
  # 2. è³ªé‡å¯©è¨ˆ
  # ============================================================
  quality_audit:
    name: "è³ªé‡å¯©è¨ˆ"
    description: "æª¢æŸ¥çŸ¥è­˜åº«çš„å…ƒæ•¸æ“šè³ªé‡"
    priority: medium

    parameters:
      optional:
        - name: severity
          type: string
          description: "æª¢æŸ¥åš´é‡ç¨‹åº¦"
          options: ["critical", "high", "all"]
          default: "all"

        - name: auto_fix
          type: boolean
          description: "æ˜¯å¦è‡ªå‹•ä¿®å¾©"
          default: false

        - name: detect_duplicates
          type: boolean
          description: "æ˜¯å¦æª¢æ¸¬é‡è¤‡è«–æ–‡"
          default: false

        - name: report_format
          type: string
          description: "å ±å‘Šæ ¼å¼"
          options: ["text", "json"]
          default: "text"

    steps:
      - id: identify_intent
        description: "ç¢ºèªæ˜¯è³ªé‡æª¢æŸ¥ä»»å‹™"

      - id: collect_parameters
        description: "æ”¶é›†åƒæ•¸"
        prompts:
          auto_fix: "ç™¼ç¾å•é¡Œæ™‚æ˜¯å¦è‡ªå‹•ä¿®å¾©ï¼Ÿ(æ˜¯/å¦ï¼Œé»˜èªï¼šå¦)"
          detect_duplicates: "æ˜¯å¦æª¢æ¸¬é‡è¤‡è«–æ–‡ï¼Ÿ(æ˜¯/å¦ï¼Œé»˜èªï¼šå¦)"

      - id: confirm
        description: "ç¢ºèªé…ç½®"
        template: |
          å³å°‡åŸ·è¡Œè³ªé‡æª¢æŸ¥ï¼š
          - åš´é‡ç¨‹åº¦: {severity}
          - è‡ªå‹•ä¿®å¾©: {auto_fix}
          - æª¢æ¸¬é‡è¤‡: {detect_duplicates}

          æ˜¯å¦ç¹¼çºŒï¼Ÿ

      - id: execute
        description: "åŸ·è¡Œè³ªé‡æª¢æŸ¥"
        skill: quality-checker
        parameters:
          severity: "{severity}"
          auto_fix: "{auto_fix}"
          detect_duplicates: "{detect_duplicates}"

      - id: report
        description: "ç”Ÿæˆå ±å‘Š"
        template: |
          âœ… è³ªé‡æª¢æŸ¥å®Œæˆï¼

          ğŸ“Š ç™¼ç¾ {issues_found} å€‹å•é¡Œï¼š
          - åš´é‡: {critical}
          - é«˜: {high}
          - è­¦å‘Š: {warning}

          {auto_fix_summary}

          è©³ç´°å ±å‘Š: {report_path}

  # ============================================================
  # 3. æ•´åˆZettelkasten
  # ============================================================
  integrate_zettel:
    name: "æ•´åˆZettelkasten"
    description: "ç´¢å¼•Zettelkastenç­†è¨˜åˆ°çŸ¥è­˜åº«"
    priority: high

    parameters:
      optional:
        - name: zettel_dir
          type: string
          description: "Zettelkastenæ ¹ç›®éŒ„"
          default: "output/zettelkasten_notes"

        - name: domain
          type: string
          description: "é™å®šé ˜åŸŸ"
          options: ["CogSci", "Linguistics", "AI", "all"]
          default: "all"

        - name: auto_link
          type: boolean
          description: "è‡ªå‹•é—œè¯è«–æ–‡"
          default: true

        - name: similarity_threshold
          type: float
          description: "è«–æ–‡åŒ¹é…ç›¸ä¼¼åº¦é–¾å€¼"
          min: 0.5
          max: 1.0
          default: 0.7

    steps:
      - id: identify_intent
        description: "ç¢ºèªæ˜¯Zettelkastenç´¢å¼•ä»»å‹™"

      - id: collect_parameters
        description: "æ”¶é›†åƒæ•¸"
        prompts:
          zettel_dir: "Zettelkastenè³‡æ–™å¤¾è·¯å¾‘ï¼Ÿ(é»˜èªï¼šoutput/zettelkasten_notes)"
          domain: "é™å®šé ˜åŸŸï¼Ÿ(CogSci/Linguistics/AI/all)"
          auto_link: "æ˜¯å¦è‡ªå‹•é—œè¯è«–æ–‡ï¼Ÿ(æ˜¯/å¦ï¼Œé»˜èªï¼šæ˜¯)"

      - id: confirm
        description: "ç¢ºèªé…ç½®"
        template: |
          å³å°‡ç´¢å¼•Zettelkastenï¼š
          - è³‡æ–™å¤¾: {zettel_dir}
          - é ˜åŸŸ: {domain}
          - è‡ªå‹•é—œè¯è«–æ–‡: {auto_link}

          æ˜¯å¦ç¹¼çºŒï¼Ÿ

      - id: execute_index
        description: "åŸ·è¡Œç´¢å¼•"
        skill: zettel-indexer
        parameters:
          zettel_folder: "{zettel_dir}"
          domain: "{domain}"

      - id: execute_link
        description: "åŸ·è¡Œè«–æ–‡é—œè¯"
        condition: "{auto_link} == true"
        skill: kb-connector
        method: auto_link_zettel_papers
        parameters:
          similarity_threshold: "{similarity_threshold}"

      - id: report
        description: "ç”Ÿæˆå ±å‘Š"
        template: |
          âœ… Zettelkastenç´¢å¼•å®Œæˆï¼

          ğŸ“Š çµ±è¨ˆï¼š
          - ç¸½å¡ç‰‡æ•¸: {total_cards}
          - æˆåŠŸç´¢å¼•: {success}
          - å¤±æ•—: {failed}

          ğŸ”— è«–æ–‡é—œè¯ï¼š
          - å·²é—œè¯: {linked}
          - æœªåŒ¹é…: {unmatched}

          è©³ç´°å ±å‘Š: {report_path}

  # ============================================================
  # 4. æœç´¢çŸ¥è­˜
  # ============================================================
  search_knowledge:
    name: "æœç´¢çŸ¥è­˜"
    description: "æœç´¢è«–æ–‡å’ŒZettelkastenå¡ç‰‡"
    priority: medium

    parameters:
      required:
        - name: query
          type: string
          description: "æœç´¢é—œéµè©"
          example: "mental simulation"

      optional:
        - name: target
          type: string
          description: "æœç´¢ç›®æ¨™"
          options: ["papers", "zettel", "all"]
          default: "all"

        - name: domain
          type: string
          description: "é™å®šé ˜åŸŸ"
          options: ["CogSci", "Linguistics", "AI", "all"]
          default: "all"

        - name: limit
          type: integer
          description: "çµæœæ•¸é‡"
          min: 1
          max: 100
          default: 20

    steps:
      - id: identify_intent
        description: "ç¢ºèªæ˜¯æœç´¢ä»»å‹™"
        action: "å¾ç”¨æˆ¶è¼¸å…¥æå–query"

      - id: collect_parameters
        description: "æ”¶é›†åƒæ•¸"
        prompts:
          target: "æœç´¢ç›®æ¨™ï¼Ÿ\n1. papersï¼ˆè«–æ–‡ï¼‰\n2. zettelï¼ˆZettelkastenï¼‰\n3. allï¼ˆå…¨éƒ¨ï¼‰"
          domain: "é™å®šé ˜åŸŸï¼Ÿ(CogSci/Linguistics/AI/all)"

      - id: execute_search
        description: "åŸ·è¡Œæœç´¢"
        actions:
          - condition: "{target} in ['zettel', 'all']"
            skill: zettel-searcher
            method: search_zettel
            parameters:
              query: "{query}"
              domain: "{domain}"
              limit: "{limit}"

          - condition: "{target} in ['papers', 'all']"
            skill: kb-connector
            method: search_papers
            parameters:
              query: "{query}"
              limit: "{limit}"

      - id: report
        description: "é¡¯ç¤ºæœç´¢çµæœ"
        template: |
          ğŸ” æœç´¢çµæœï¼š'{query}'

          {zettel_results}
          {paper_results}

  # ============================================================
  # 5. ç”Ÿæˆç°¡å ±
  # ============================================================
  generate_slides:
    name: "ç”Ÿæˆç°¡å ±"
    description: "ç”Ÿæˆå­¸è¡“ç°¡å ±ï¼ˆPPTX/Markdownï¼‰"
    priority: medium

    parameters:
      required:
        - name: topic
          type: string
          description: "ç°¡å ±ä¸»é¡Œ"

        - name: source
          type: string
          description: "ä¾†æºï¼ˆpaper_id/pdf_path/from-kbï¼‰"

      optional:
        - name: style
          type: string
          description: "ç°¡å ±é¢¨æ ¼"
          options: ["modern_academic", "research_methods", "literature_review", "teaching"]
          default: "modern_academic"

        - name: detail
          type: string
          description: "è©³ç´°ç¨‹åº¦"
          options: ["brief", "standard", "detailed"]
          default: "standard"

        - name: language
          type: string
          description: "èªè¨€"
          options: ["chinese", "english", "bilingual"]
          default: "chinese"

        - name: slides
          type: integer
          description: "æŠ•å½±ç‰‡æ•¸é‡"
          default: 15

        - name: format
          type: string
          description: "è¼¸å‡ºæ ¼å¼"
          options: ["pptx", "markdown", "both"]
          default: "pptx"

    steps:
      - id: identify_intent
        description: "ç¢ºèªæ˜¯ç°¡å ±ç”Ÿæˆä»»å‹™"

      - id: collect_parameters
        description: "æ”¶é›†åƒæ•¸"
        prompts:
          topic: "ç°¡å ±ä¸»é¡Œï¼Ÿ"
          source: "ä¾†æºï¼Ÿ(paper_id/pdfè·¯å¾‘/from-kb)"
          style: "é¢¨æ ¼ï¼Ÿ(modern_academic/research_methods/literature_review/teaching)"

      - id: confirm
        description: "ç¢ºèªé…ç½®"
        template: |
          å³å°‡ç”Ÿæˆç°¡å ±ï¼š
          - ä¸»é¡Œ: {topic}
          - ä¾†æº: {source}
          - é¢¨æ ¼: {style}
          - è©³ç´°ç¨‹åº¦: {detail}
          - èªè¨€: {language}
          - æŠ•å½±ç‰‡æ•¸: {slides}

          æ˜¯å¦ç¹¼çºŒï¼Ÿ

      - id: execute
        description: "ç”Ÿæˆç°¡å ±"
        skill: slide-maker
        parameters:
          topic: "{topic}"
          source: "{source}"
          style: "{style}"
          detail: "{detail}"
          language: "{language}"
          slides: "{slides}"
          format: "{format}"

      - id: report
        description: "é¡¯ç¤ºçµæœ"
        template: |
          âœ… ç°¡å ±ç”Ÿæˆå®Œæˆï¼

          ğŸ“Š è¼¸å‡ºï¼š
          - æ ¼å¼: {format}
          - æŠ•å½±ç‰‡æ•¸: {slides}
          - æ–‡ä»¶è·¯å¾‘: {output_path}

  # ============================================================
  # 6. ç”Ÿæˆç­†è¨˜
  # ============================================================
  generate_notes:
    name: "ç”Ÿæˆç­†è¨˜"
    description: "ç”ŸæˆZettelkastenåŸå­ç­†è¨˜"
    priority: medium

    parameters:
      required:
        - name: source
          type: string
          description: "ä¾†æºï¼ˆpaper_id/pdf_pathï¼‰"

      optional:
        - name: domain
          type: string
          description: "é ˜åŸŸ"
          options: ["CogSci", "Linguistics", "AI"]
          default: "CogSci"

        - name: card_count
          type: integer
          description: "å¡ç‰‡æ•¸é‡"
          min: 5
          max: 50
          default: 20

        - name: detail_level
          type: string
          description: "è©³ç´°ç¨‹åº¦"
          options: ["brief", "standard", "detailed"]
          default: "detailed"

        - name: llm_provider
          type: string
          description: "LLMæä¾›è€…"
          options: ["google", "openai", "ollama"]
          default: "google"

    steps:
      - id: identify_intent
        description: "ç¢ºèªæ˜¯ç­†è¨˜ç”Ÿæˆä»»å‹™"

      - id: collect_parameters
        description: "æ”¶é›†åƒæ•¸"
        prompts:
          source: "ä¾†æºï¼Ÿ(paper_idæˆ–PDFè·¯å¾‘)"
          domain: "é ˜åŸŸï¼Ÿ(CogSci/Linguistics/AI)"
          card_count: "å¡ç‰‡æ•¸é‡ï¼Ÿ(é»˜èªï¼š20)"

      - id: confirm
        description: "ç¢ºèªé…ç½®"
        template: |
          å³å°‡ç”ŸæˆZettelkastenç­†è¨˜ï¼š
          - ä¾†æº: {source}
          - é ˜åŸŸ: {domain}
          - å¡ç‰‡æ•¸: {card_count}
          - è©³ç´°ç¨‹åº¦: {detail_level}

          æ˜¯å¦ç¹¼çºŒï¼Ÿ

      - id: execute
        description: "ç”Ÿæˆç­†è¨˜"
        skill: zettel-maker
        parameters:
          source: "{source}"
          domain: "{domain}"
          card_count: "{card_count}"
          detail_level: "{detail_level}"
          llm_provider: "{llm_provider}"

      - id: report
        description: "é¡¯ç¤ºçµæœ"
        template: |
          âœ… Zettelkastenç­†è¨˜ç”Ÿæˆå®Œæˆï¼

          ğŸ“Š è¼¸å‡ºï¼š
          - å¡ç‰‡æ•¸: {card_count}
          - é ˜åŸŸ: {domain}
          - è³‡æ–™å¤¾: {output_path}

          ğŸ’¡ å»ºè­°ï¼šä½¿ç”¨ /integrate-zettel å°‡ç­†è¨˜ç´¢å¼•åˆ°çŸ¥è­˜åº«

# ============================================================
# éŒ¯èª¤è™•ç†é…ç½®
# ============================================================
error_handling:
  global_strategy: "graceful"
  retry_limit: 1
  timeout: 300  # ç§’

  common_errors:
    - error: "FileNotFoundError"
      message: "æ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶æˆ–è³‡æ–™å¤¾"
      suggestion: "è«‹æª¢æŸ¥è·¯å¾‘æ˜¯å¦æ­£ç¢º"

    - error: "PermissionError"
      message: "æ²’æœ‰æ¬Šé™è¨ªå•æ–‡ä»¶"
      suggestion: "è«‹æª¢æŸ¥æ–‡ä»¶æ¬Šé™æˆ–ä»¥ç®¡ç†å“¡èº«ä»½åŸ·è¡Œ"

    - error: "TimeoutError"
      message: "æ“ä½œè¶…æ™‚"
      suggestion: "è«‹æ¸›å°‘è™•ç†æ•¸é‡æˆ–å¢åŠ timeoutè¨­å®š"

    - error: "IntegrityError"
      message: "æ•¸æ“šåº«å®Œæ•´æ€§éŒ¯èª¤"
      suggestion: "å¯èƒ½å­˜åœ¨é‡è¤‡è¨˜éŒ„ï¼Œè«‹æª¢æŸ¥æ•¸æ“š"

# ============================================================
# å ±å‘Šæ¨¡æ¿
# ============================================================
report_templates:
  batch_import: "BATCH_IMPORT_REPORT_{timestamp}.md"
  quality_audit: "QUALITY_AUDIT_REPORT_{timestamp}.md"
  integrate_zettel: "ZETTEL_INDEX_REPORT_{timestamp}.md"
  search_results: "SEARCH_RESULTS_{timestamp}.txt"

# ============================================================
# Agentå…ƒæ•¸æ“š
# ============================================================
metadata:
  version: "1.0.0-mvp"
  created: "2025-10-30"
  updated: "2025-10-30"
  author: "Claude Code (Sonnet 4.5)"
  status: "active"
